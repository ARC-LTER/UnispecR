ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise(
avg_ndvi = mean(NDVI),
sd_ndvi = sd(NDVI)
) %>%
group_by(Site,Treatment,Date) %>%
summarise_at(.vars = vars(avg_ndvi), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~. ) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5]))
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise(
avg_ndvi = mean(NDVI),
sd_ndvi = sd(NDVI)
) %>%
group_by(Site,Treatment,Date) %>%
summarise_at(.vars = vars(avg_ndvi), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~. ) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5]))
ndvi_ggplot
#PLOT SUBSET -- SPECIFY SITE/DATE/ETC to ZOOM IN ON
check_dates <- df %>% select(Date) %>% pull()#ymd("2017-06-08", "2017-06-15", "2017-06-26")
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise(
avg_ndvi = mean(NDVI),
sd_ndvi = sd(NDVI)
) %>%
group_by(Site,Treatment,Date) %>%
summarise_at(.vars = vars(avg_ndvi), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~. ) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5]))
ndvi_ggplot
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~. ) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_ggplot
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_plot
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_ggplot
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme(base_size = 16) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme_gray(base_size = 16) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_ggplot
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme_gray(base_size = 14) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_ggplot
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(Site != "LAB2") %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(Site != "LAB2|SHB2") %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme_gray(base_size = 14) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_ggplot
filter(!str_detect(Site, "LAB2|SHB2") %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme_gray(base_size = 14) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_field_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme_gray(base_size = 14) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_ggplot
data_path <- "/home/ruby/UnispecR/UnispecRecord/UnispecData/2019/"
dir_year <- "2019"
## Raw Data
raw_filename <- paste0(data_path, dir_year, "_raw_spu_data.rds")
spu_spectra <- read_rds(raw_filename)
raw_keyname <- paste0(data_path, dir_year, "_raw_spu_key.csv")
spu_key <- read_csv(raw_keyname)
spu_dataframe <- full_join(spu_spectra, spu_key) %>%
#mutate(DateTime = lubridate::ymd_hms(DateTime, tz = "US/Alaska")) %>%
mutate(Date = str_extract(spu_filename, pattern = "^[0-9]{4}-[0-9]{2}-[0-9]{2}")) %>%  # from filename, not DateTime (sometimes discrepancy in unispec instrument time)
arrange(DateTime)
## Processed Data
processed_dataframe <- read_rds(paste0(data_path, "2019_processed_spu_data.rds")) %>%
mutate(DateTime = lubridate::as_datetime(DateTime, tz="US/Alaska"))
## Index Data
index_data <- read_rds(paste0(data_path, "2019_index_data.rds")) %>%
select(spu_filename, DateTime, ref_filenames, Spectra, Indices)
ndvi_data <- index_data %>% unnest(Indices) %>%
spread(Index, Value) %>% select(-EVI, -EVI2)
## File Key
unispec_file_key <- read_csv(paste0(data_path, "2019_unispec_field_key.csv")) %>%
full_join(read_csv(paste0(data_path, "2019_raw_spu_key.csv")))
## joined data
df <- unispec_file_key %>% left_join(processed_dataframe)
#PLOT SUBSET -- SPECIFY SITE/DATE/ETC to ZOOM IN ON
check_dates <- df %>% select(Date) %>% pull()#ymd("2017-06-08", "2017-06-15", "2017-06-26")
getwd()
ndvi_plot <- ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
CT <- c("CT1", "CT2", "CT")
check_dates <- df %>% select(Date) %>% pull()#ymd("2017-06-08", "2017-06-15", "2017-06-26")
check_blocks <- c("B1", "B2", "B3", "B4")
check_trtmts <- c(CT, "F0.5", "F1", "F2", "F5", "F10", "N", "P", "NP")
## PLOT OPTIONS
# Color Palettes
n_yellow <- rgb(255, 192, 0, maxColorValue = 255)
p_blue <- rgb(46, 117, 182, maxColorValue = 255)
np_green <- rgb(112, 173, 71, maxColorValue = 255) #lmat_colors[5]
ct_gray <- rgb(175, 171, 171, maxColorValue = 255)
lmat_colors <- c(rgb(226, 240, 217, maxColorValue = 255), rgb(169, 209, 142, maxColorValue = 255), rgb(112, 173, 71, maxColorValue = 255), rgb(84, 130, 53, maxColorValue = 255), rgb(56, 87, 35, maxColorValue = 255))
ndvi_plot <- ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme_gray(base_size = 14) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs
ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs
ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs
ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date)
ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date)
ndvi_data %>% left_join(unispec_file_key) %>%
filter(str_detect(Location, pattern = "[0-9]S")) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date)
ndvi_plot
### DATA
ndvi_plot <- ndvi_data %>% left_join(unispec_file_key) %>%
filter(!str_detect(Block, "EDC")) %>%
filter(!is.na(Treatment)) %>%
filter(!str_detect(Site, "LAB2|SHB2")) %>%
mutate(Site = ifelse(Site %in% c("WSG1", "WSG23"), "WSG", Site))  %>%
mutate(Treatment = replace(Treatment, Treatment %in% CT, "CT")) %>%
mutate(Treatment = factor(Treatment, levels = check_trtmts)) %>%
group_by(Site, Block, Treatment, Date) %>%
summarise_at(.vars = vars(NDVI), .funs = funs(mean,sd,se=sd(.)/sqrt(n())))
ndvi_ggplot <- ggplot(data = ndvi_plot, mapping = aes(x = Date, y = mean, color=Treatment)) +
geom_line() +
geom_errorbar( aes(ymin = mean-se, ymax= mean + se), width=2) +
geom_point() +
facet_grid(Site ~ Block) +
theme_gray(base_size = 14) +
scale_color_manual(values=c("CT" = ct_gray, "CT1" = ct_gray, "CT2"= ct_gray,
"N" = n_yellow, "NO3" = "skyblue", "NH4" = "deepskyblue",
"P" = p_blue,
"NP" = lmat_colors[5],
"F0.5" = lmat_colors[1],
"F1" = lmat_colors[2],
"F2" = lmat_colors[3],
"F5" = lmat_colors[4],
"F10" = lmat_colors[5])) +
labs(y = "Mean NDVI")
CT <- c("CT1", "CT2", "CT")
check_dates <- df %>% select(Date) %>% pull()#ymd("2017-06-08", "2017-06-15", "2017-06-26")
check_blocks <- c("B1", "B2", "B3", "B4")
check_trtmts <- c(CT, "F0.5", "F1", "F2", "F5", "F10", "N", "P", "NP")
## PLOT OPTIONS
# Color Palettes
n_yellow <- rgb(255, 192, 0, maxColorValue = 255)
p_blue <- rgb(46, 117, 182, maxColorValue = 255)
np_green <- rgb(112, 173, 71, maxColorValue = 255) #lmat_colors[5]
ct_gray <- rgb(175, 171, 171, maxColorValue = 255)
lmat_colors <- c(rgb(226, 240, 217, maxColorValue = 255), rgb(169, 209, 142, maxColorValue = 255), rgb(112, 173, 71, maxColorValue = 255), rgb(84, 130, 53, maxColorValue = 255), rgb(56, 87, 35, maxColorValue = 255))
